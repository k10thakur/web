<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToldYa! - Prediction Reveal</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#FF9B76", secondary: "#FFC8B3" },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
    <style>
      :where([class^="ri-"])::before { content: "\f3c2"; }
      body {
      background-color: #FF9B76;
      font-family: 'Inter', sans-serif;
      }
      .ad-container {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #FFF5F0;
      color: #9CA3AF;
      }
      @media (max-width: 768px) {
      .desktop-ads {
      display: none;
      }
      }
      @media (min-width: 769px) {
      .mobile-ads {
      display: none;
      }
      }
    </style>
  </head>
  <body>
    <div class="min-h-screen flex flex-col">
      <!-- Mobile Top Ad -->
      <div class="mobile-ads w-full h-16 ad-container">Google Ad Space</div>
      <div
        class="flex-1 flex flex-col md:flex-row justify-center items-center p-4"
      >
        <!-- Desktop Left Ad -->
        <div class="desktop-ads w-64 h-96 mx-4 ad-container">
          Google Ad Space
        </div>
        <!-- Main Content -->
        <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-6 my-8">
          <div class="flex justify-center mb-6">
            <div class="flex items-center gap-2 text-primary">
              <div
                class="w-8 h-8 flex items-center justify-center bg-primary rounded-full"
              >
                <i class="ri-eye-line text-white"></i>
              </div>
              <h1 class="text-3xl font-['Pacifico']">ToldYa!</h1>
            </div>
          </div>
          <div id="prediction-content" class="space-y-6">
            <div
              class="bg-gradient-to-br from-primary/5 to-secondary/10 rounded-lg p-6"
            >
              <div class="flex items-start gap-4 mb-6">
                <div
                  class="w-14 h-14 bg-primary/20 rounded-full flex-shrink-0 flex items-center justify-center"
                >
                  <i class="ri-magic-line text-primary ri-2x"></i>
                </div>
                <div class="min-w-0">
                  <p
                    id="predictor-name"
                    class="text-xl font-semibold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent break-words"
                  >
                    Loading...
                  </p>
                  <p class="text-sm text-gray-600">Mystery Predictor</p>
                </div>
              </div>
              <div class="space-y-4">
                <div class="flex items-start gap-3 p-4 bg-white/50 rounded-lg">
                  <div
                    class="w-8 h-8 flex-shrink-0 flex items-center justify-center"
                  >
                    <i
                      class="ri-lightbulb-flash-line text-yellow-500 ri-lg"
                    ></i>
                  </div>
                  <div class="min-w-0">
                    <p class="text-gray-900">Has a prediction about</p>
                    <p
                      id="prediction-topic"
                      class="text-lg font-medium text-primary break-words leading-relaxed"
                    >
                      Loading...
                    </p>
                  </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-white/50 rounded-lg">
                  <div class="w-8 h-8 flex items-center justify-center">
                    <i class="ri-quill-pen-line text-blue-500 ri-lg"></i>
                  </div>
                  <div>
                    <p class="text-gray-900">Sealed this prediction on</p>
                    <p id="creation-time" class="text-lg font-medium">
                      Loading...
                    </p>
                  </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-white/50 rounded-lg">
                  <div class="w-8 h-8 flex items-center justify-center">
                    <i class="ri-timer-flash-line text-green-500 ri-lg"></i>
                  </div>
                  <div>
                    <p class="text-gray-900">The truth unveils on</p>
                    <p id="reveal-time" class="text-lg font-medium">
                      Loading...
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div id="countdown-section" class="space-y-4">
              <div class="flex items-center justify-center gap-2 text-primary">
                <i class="ri-time-line ri-lg"></i>
                <p class="text-lg font-medium">Time Until The Big Reveal</p>
              </div>
              <div class="flex gap-3">
                <div
                  class="flex-1 bg-gradient-to-br from-primary/5 to-secondary/10 rounded-lg p-3 text-center transform hover:scale-105 transition-transform"
                >
                  <span id="days" class="text-2xl font-bold text-primary"
                    >--</span
                  >
                  <p class="text-sm text-gray-600">Days</p>
                </div>
                <div
                  class="flex-1 bg-gradient-to-br from-primary/5 to-secondary/10 rounded-lg p-3 text-center transform hover:scale-105 transition-transform"
                >
                  <span id="hours" class="text-2xl font-bold text-primary"
                    >--</span
                  >
                  <p class="text-sm text-gray-600">Hours</p>
                </div>
                <div
                  class="flex-1 bg-gradient-to-br from-primary/5 to-secondary/10 rounded-lg p-3 text-center transform hover:scale-105 transition-transform"
                >
                  <span id="minutes" class="text-2xl font-bold text-primary"
                    >--</span
                  >
                  <p class="text-sm text-gray-600">Minutes</p>
                </div>
                <div
                  class="flex-1 bg-gradient-to-br from-primary/5 to-secondary/10 rounded-lg p-3 text-center transform hover:scale-105 transition-transform"
                >
                  <span id="seconds" class="text-2xl font-bold text-primary"
                    >--</span
                  >
                  <p class="text-sm text-gray-600">Seconds</p>
                </div>
              </div>
            </div>
            <div id="message-section" class="hidden space-y-4">
              <div
                class="flex items-center justify-center gap-2 text-green-500"
              >
                <i class="ri-checkbox-circle-line ri-lg"></i>
                <p class="text-lg font-medium">The Prediction Is Revealed!</p>
              </div>
              <div
                class="bg-gradient-to-br from-green-50 to-primary/5 rounded-lg p-6 border-2 border-green-100"
              >
                <div class="flex items-center gap-3 mb-4">
                  <i class="ri-sparkling-line text-green-500 ri-lg"></i>
                  <p class="text-lg font-medium text-green-700">
                    Here's what was predicted:
                  </p>
                </div>
                <div class="relative">
                  <div
                    class="absolute inset-0 bg-gradient-to-b from-transparent to-white/90 pointer-events-none hidden"
                    id="message-fade"
                  ></div>
                  <p
                    id="prediction-message"
                    class="text-xl text-gray-800 font-medium whitespace-pre-wrap break-words leading-relaxed max-h-[300px] overflow-y-auto pr-2"
                  >
                    Loading...
                  </p>
                </div>
              </div>
            </div>
            <div
              id="waiting-message"
              class="bg-gradient-to-br from-yellow-50 to-primary/5 rounded-lg p-6 text-center border-2 border-yellow-100"
            >
              <div class="flex items-center justify-center gap-3 mb-2">
                <i class="ri-lock-line text-yellow-500 ri-lg"></i>
                <p class="text-lg font-medium text-yellow-700">
                  This Prediction Is Still Sealed
                </p>
              </div>
              <p class="text-gray-600">
                The mystery will be unveiled when the countdown reaches zero.
                Stay tuned!
              </p>
            </div>
            <div class="pt-4 text-center">
              <a
                href="/"
                class="inline-flex items-center text-primary hover:text-primary/80"
              >
                <i class="ri-arrow-left-line mr-1"></i> Make your own prediction
              </a>
            </div>
          </div>
        </div>
        <!-- Desktop Right Ad -->
        <div class="desktop-ads w-64 h-96 mx-4 ad-container">
          Google Ad Space
        </div>
      </div>
      <!-- Mobile Bottom Ad -->
      <div class="mobile-ads w-full h-16 ad-container">Google Ad Space</div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Extract message_id from URL
        const urlParams = new URLSearchParams(window.location.search);
        let messageId = urlParams.get("message_id");
        // If no message_id in query params, try to extract from path
        if (!messageId) {
          const pathParts = window.location.pathname.split("/");
          messageId = pathParts[pathParts.length - 1];
        }
        if (!messageId) {
          showError("No prediction ID found in the URL.");
          return;
        }
        // Fetch prediction data
        fetch(
          `https://nrl7cm3dopjbv3vpixbuupwkc40hmacn.lambda-url.eu-north-1.on.aws/toldya?message_id=${messageId}`,
        )
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            displayPredictionData(data);
          })
          .catch((error) => {
            showError(
              "Failed to load prediction data. It might not exist or has been removed.",
            );
            console.error("Error fetching prediction data:", error);
          });
      });
      function displayPredictionData(data) {
        // Display basic prediction info
        const predictorName = data.name || "Anonymous";
        const subject = data.subject || "Unspecified";
        document.getElementById("predictor-name").textContent =
          predictorName.length > 32
            ? predictorName.substring(0, 32) + "..."
            : predictorName;
        document.getElementById("prediction-topic").textContent =
          subject.length > 150 ? subject.substring(0, 150) + "..." : subject;
        // Add tooltip for truncated text
        if (predictorName.length > 32) {
          document.getElementById("predictor-name").title = predictorName;
        }
        if (subject.length > 150) {
          document.getElementById("prediction-topic").title = subject;
        }
        // Format and display timestamps
        const creationDate = new Date(data.messageCreateTime * 1000);
        const revealDate = new Date(data.revealTime * 1000);
        document.getElementById("creation-time").textContent =
          formatDate(creationDate);
        document.getElementById("reveal-time").textContent = formatDate(revealDate);
        // Check if message should be revealed
        const now = new Date();
        if (data.message && now >= revealDate) {
          const messageElement = document.getElementById("prediction-message");
          messageElement.textContent = data.message;
          // Show fade effect if content is long
          const messageFade = document.getElementById("message-fade");
          if (messageElement.scrollHeight > 300) {
            messageFade.classList.remove("hidden");
          }
          document.getElementById("message-section").classList.remove("hidden");
          document.getElementById("waiting-message").classList.add("hidden");
          document.getElementById("countdown-section").classList.add("hidden");
          // Add scroll event listener for fade effect
          messageElement.addEventListener("scroll", function () {
            const isNearBottom =
              this.scrollHeight - this.scrollTop - this.clientHeight < 50;
            messageFade.style.opacity = isNearBottom ? "0" : "1";
          });
        } else {
          // Start countdown
          document.getElementById("waiting-message").classList.remove("hidden");
          startCountdown(revealDate);
        }
      }
      function startCountdown(revealDate) {
        const countdownInterval = setInterval(function () {
          const now = new Date();
          const distance = revealDate - now;
          if (distance <= 0) {
            clearInterval(countdownInterval);
            window.location.reload(); // Reload to show the message
            return;
          }
          // Calculate time units
          const days = Math.floor(distance / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
          );
          const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((distance % (1000 * 60)) / 1000);
          // Update countdown display
          document.getElementById("days").textContent = days;
          document.getElementById("hours").textContent = hours;
          document.getElementById("minutes").textContent = minutes;
          document.getElementById("seconds").textContent = seconds;
        }, 1000);
      }
      function formatDate(date) {
        const options = {
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        };
        return date.toLocaleDateString("en-US", options);
      }
      function showError(message) {
        const contentDiv = document.getElementById("prediction-content");
        contentDiv.innerHTML = `
      <div class="text-center py-8">
      <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center bg-red-100 rounded-full">
      <i class="ri-error-warning-line text-red-500 ri-2x"></i>
      </div>
      <h2 class="text-xl font-semibold mb-2">Oops!</h2>
      <p class="text-gray-600">${message}</p>
      <div class="mt-6">
      <a href="/" class="inline-flex items-center text-primary hover:text-primary/80">
      <i class="ri-arrow-left-line mr-1"></i> Back to home
      </a>
      </div>
      </div>
      `;
      }
    </script>
  </body>
</html>
